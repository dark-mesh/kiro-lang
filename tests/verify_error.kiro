error NotFound = "File not found"
error PermissionDenied = "Access denied"

fn maybe_fail(code: num) -> str! {
    on (code == 1) {
        return NotFound
    }
    on (code == 2) {
        return PermissionDenied
    }
    return "Success!"
}

fn process(code: num) -> str! {
    var result = maybe_fail(code)
    
    on (result) {
        print "Got: "
        print result
        return result
    } error NotFound {
        print "NotFound caught, propagating..."
        // Implicit return of error
    }
}

fn main() {
    print "--- Error Handling Test ---"
    
    // Test 1: Success path
    print "Test 1: Success"
    // Since main is not failable, we must handle the result of maybe_fail
    var a = maybe_fail(0) 
    on (a) {
        print a
    } error {
        print "Unexpected error"
    }
    
    // Test 2: Error creation and return
    print "Test 2: Error creation"
    var b = maybe_fail(1)
    on (b) {
        print "This should not print"
    } error NotFound {
        print "NotFound handled!"
    }
    
    // Test 3: Error propagation
    print "Test 3: Propagation"
    var c = process(1)
    on (c) {
        print c
    } error NotFound {
        print "NotFound propagated successfully!"
    }
    
    print "--- All Tests Passed ---"
}
main()
